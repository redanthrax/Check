@inherits LayoutView
@using CheckWebAssembly.Services
@inject IJSRuntime JSRuntime

<div class="main-layout @contextClass">
    <header class="extension-header">
        <div class="header-content">
            <img src="images/icon32.png" alt="Check" class="header-logo" />
            <h1 class="header-title">@headerTitle</h1>
        </div>
        @if (showNavigation)
        {
            <nav class="header-nav">
                <a href="/" class="nav-link @(currentView == "home" ? "active" : "")">Dashboard</a>
                <a href="/?view=popup" class="nav-link @(currentView == "popup" ? "active" : "")">Status</a>
                <a href="/?view=options" class="nav-link @(currentView == "options" ? "active" : "")">Settings</a>
            </nav>
        }
    </header>

    <main class="extension-main">
        @Body
    </main>
</div>

@code {
    private string contextClass = "";
    private string headerTitle = "Check Extension";
    private string currentView = "home";
    private bool showNavigation = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await DetermineContext();
            StateHasChanged();
        }
    }

    private async Task DetermineContext()
    {
        try
        {
            var uri = await JSRuntime.InvokeAsync<string>("location.href");
            var parsedUri = new Uri(uri);
            var query = System.Web.HttpUtility.ParseQueryString(parsedUri.Query);
            var view = query["view"]?.ToLower();

            currentView = view ?? "home";
            
            switch (currentView)
            {
                case "popup":
                    contextClass = "popup-layout";
                    headerTitle = "Check Status";
                    showNavigation = false;
                    break;
                case "options":
                    contextClass = "options-layout";
                    headerTitle = "Check Settings";
                    showNavigation = true;
                    break;
                default:
                    contextClass = "default-layout";
                    headerTitle = "Check Extension";
                    showNavigation = true;
                    break;
            }
        }
        catch
        {
            // Fallback to default
            contextClass = "default-layout";
            headerTitle = "Check Extension";
            showNavigation = true;
        }
    }
}

<style>
    .main-layout {
        display: flex;
        flex-direction: column;
        height: 100vh;
        background: linear-gradient(135deg, #003049 0%, #005C63 100%);
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .popup-layout {
        width: 350px;
        height: 500px;
        max-width: 350px;
        max-height: 500px;
    }

    .options-layout {
        min-height: 600px;
    }

    .extension-header {
        background: rgba(0, 0, 0, 0.1);
        padding: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .popup-layout .extension-header {
        padding: 0.75rem 1rem;
    }

    .header-content {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .header-logo {
        width: 24px;
        height: 24px;
    }

    .header-title {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: #F77F00;
    }

    .popup-layout .header-title {
        font-size: 1rem;
    }

    .header-nav {
        margin-top: 0.75rem;
        display: flex;
        gap: 1rem;
    }

    .nav-link {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        padding: 0.5rem 0.75rem;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .nav-link:hover {
        color: white;
        background: rgba(247, 127, 0, 0.1);
    }

    .nav-link.active {
        color: #F77F00;
        background: rgba(247, 127, 0, 0.1);
    }

    .extension-main {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
    }

    .popup-layout .extension-main {
        padding: 0.75rem;
    }
</style>